# Rochelle Knight, Venexia Walker, et al., 2024.

import sys, csv, re

codes = [{"code":"C44","system":"icd10"},{"code":"C43","system":"icd10"},{"code":"188454009","system":"icd10"},{"code":"93647006","system":"icd10"},{"code":"109264009","system":"icd10"},{"code":"396181000000106","system":"icd10"},{"code":"254653005","system":"icd10"},{"code":"254726003","system":"icd10"},{"code":"254730000","system":"icd10"},{"code":"93643005","system":"icd10"},{"code":"254731001","system":"icd10"},{"code":"188458007","system":"icd10"},{"code":"93225001","system":"icd10"},{"code":"94566009","system":"icd10"},{"code":"188102008","system":"icd10"},{"code":"188459004","system":"icd10"},{"code":"93230002","system":"icd10"},{"code":"254797000","system":"icd10"},{"code":"93956001","system":"icd10"},{"code":"254707006","system":"icd10"},{"code":"276751004","system":"icd10"},{"code":"94579000","system":"icd10"},{"code":"94554003","system":"icd10"},{"code":"254732008","system":"icd10"},{"code":"276738009","system":"icd10"},{"code":"93655004","system":"icd10"},{"code":"307610008","system":"icd10"},{"code":"254714008","system":"icd10"},{"code":"94575006","system":"icd10"},{"code":"254712007","system":"icd10"},{"code":"254794007","system":"icd10"},{"code":"285631006","system":"icd10"},{"code":"314987003","system":"icd10"},{"code":"398670003","system":"icd10"},{"code":"255093003","system":"icd10"},{"code":"254708001","system":"icd10"},{"code":"93217003","system":"icd10"},{"code":"314988008","system":"icd10"},{"code":"93210001","system":"icd10"},{"code":"254711000","system":"icd10"},{"code":"271467005","system":"icd10"},{"code":"93209006","system":"icd10"},{"code":"276750003","system":"icd10"},{"code":"314976006","system":"icd10"},{"code":"93223008","system":"icd10"},{"code":"94544002","system":"icd10"},{"code":"404149003","system":"icd10"},{"code":"255068000","system":"icd10"},{"code":"93651008","system":"icd10"},{"code":"307603002","system":"icd10"},{"code":"109267002","system":"icd10"},{"code":"255101006","system":"icd10"},{"code":"79268002","system":"icd10"},{"code":"254709009","system":"icd10"},{"code":"254713002","system":"icd10"},{"code":"B3378","system":"icd10"},{"code":"B335.","system":"icd10"},{"code":"B32..","system":"icd10"},{"code":"B3350","system":"icd10"},{"code":"B32y.","system":"icd10"},{"code":"B3362","system":"icd10"},{"code":"B3...","system":"icd10"},{"code":"B3341","system":"icd10"},{"code":"B3361","system":"icd10"},{"code":"B337z","system":"icd10"},{"code":"B3351","system":"icd10"},{"code":"B333.","system":"icd10"},{"code":"B3330","system":"icd10"},{"code":"B3333","system":"icd10"},{"code":"B3371","system":"icd10"},{"code":"B3331","system":"icd10"},{"code":"B3356","system":"icd10"},{"code":"1J0G.","system":"icd10"},{"code":"B582z","system":"icd10"},{"code":"B3373","system":"icd10"},{"code":"B5820","system":"icd10"},{"code":"B32y0","system":"icd10"},{"code":"B5826","system":"icd10"},{"code":"B334z","system":"icd10"},{"code":"B3377","system":"icd10"},{"code":"B3z..","system":"icd10"},{"code":"B5822","system":"icd10"},{"code":"B3372","system":"icd10"},{"code":"B33..","system":"icd10"},{"code":"B5824","system":"icd10"},{"code":"B333z","system":"icd10"},{"code":"B3334","system":"icd10"},{"code":"B5823","system":"icd10"},{"code":"B3359","system":"icd10"},{"code":"B332.","system":"icd10"},{"code":"B3335","system":"icd10"},{"code":"B3370","system":"icd10"},{"code":"Byu4.","system":"icd10"},{"code":"B3374","system":"icd10"},{"code":"8Hn0.","system":"icd10"},{"code":"B336z","system":"icd10"},{"code":"B5825","system":"icd10"},{"code":"B3375","system":"icd10"},{"code":"B3353","system":"icd10"},{"code":"B335z","system":"icd10"},{"code":"B3364","system":"icd10"},{"code":"B336.","system":"icd10"},{"code":"Byu5A","system":"icd10"},{"code":"B3365","system":"icd10"},{"code":"B3355","system":"icd10"},{"code":"Byu43","system":"icd10"},{"code":"B332z","system":"icd10"},{"code":"Byu41","system":"icd10"},{"code":"B3363","system":"icd10"},{"code":"1425","system":"icd10"},{"code":"B3358","system":"icd10"},{"code":"7G03K","system":"icd10"},{"code":"B3354","system":"icd10"},{"code":"B3379","system":"icd10"},{"code":"B3332","system":"icd10"},{"code":"B33X.","system":"icd10"},{"code":"Byu42","system":"icd10"},{"code":"B337.","system":"icd10"},{"code":"B3320","system":"icd10"},{"code":"B3y..","system":"icd10"},{"code":"B33y.","system":"icd10"},{"code":"B3360","system":"icd10"},{"code":"B330.","system":"icd10"},{"code":"B335A","system":"icd10"},{"code":"B338.","system":"icd10"},{"code":"B32z.","system":"icd10"},{"code":"B334.","system":"icd10"},{"code":"B3321","system":"icd10"},{"code":"B3357","system":"icd10"},{"code":"B33z.","system":"icd10"},{"code":"B582.","system":"icd10"},{"code":"B3352","system":"icd10"}];
REQUIRED_CODES = 1;
with open(sys.argv[1], 'r') as file_in, open('ccu002_01-cancer-potential-cases.csv', 'w', newline='') as file_out:
    csv_reader = csv.DictReader(file_in)
    csv_writer = csv.DictWriter(file_out, csv_reader.fieldnames + ["ccu002_01-cancer-mskin---secondary-identified"])
    csv_writer.writeheader();
    codes_identified = 0;
    for row in csv_reader:
        newRow = row.copy();
        for cell in row:
            # Iterate cell lists (e.g. codes)
            for item in re.findall(r'\(([^,]*)\,', row[cell]):
                if(item in list(map(lambda code: code['code'], codes))): codes_identified+=1;
                if(codes_identified>=REQUIRED_CODES):
                    newRow["ccu002_01-cancer-mskin---secondary-identified"] = "CASE";
                    break;
            if(codes_identified>=REQUIRED_CODES): break;
        if(codes_identified<REQUIRED_CODES):
            newRow["ccu002_01-cancer-mskin---secondary-identified"] = "UNK";
        codes_identified=0;
        csv_writer.writerow(newRow)
